<!DOCTYPE html>
<html lang="zh">
    <head>
        <script src="https://unpkg.com/vue/dist/vue.js"></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="../../js/base.js"></script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="moqunzhu">

        <title>Bind</title>
        <!-- Custom styles -->
        <link href="../../css/weui-custom-style.css" rel="stylesheet">

        <!-- WeUI styles -->
        <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.0/weui.min.css">

        <!-- WeUI Javascript library -->
        <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

</head>

<body>
    <!-- 正在加载 -->
    <div class="weui-loadmore">
        <i class="weui-loading"></i>
        <span class="weui-loadmore__tips">正在加载</span>
    </div>

    <!-- Header -->
    <!-- 绑定 --> 
    <div id="bind-container" style="display: none;">
    <h1 class="news-title">绑定</h1>

    <div class="weui-cells__title">请输入学号与info密码</div>
    <div class="weui-cells weui-cells_form">
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">学  号</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="inputUsername" placeholder=""/>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">密  码</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="password" id="inputPassword" placeholder=""/>
            </div>
        </div>
    </div>
    <a href="javascript:;" class="weui-btn weui-btn_primary" id="confirm-button">确认</a>
    </div>

    <div class="detail-dialog" style="display: none;" id="msg-dialog">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">{{ msg.title }}</strong></div>
            <div class="weui-dialog__bd">{{ msg.content }}</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">确定</a>
            </div>
        </div>
    </div>
    </div>


     <!-- 解绑 --> 
    <div id="unbind-container" style="display: none;">
    <h1 class="news-title">解绑</h1>
    <div class="weui-cells__title">点击按钮确认解绑帐号{{id}}</div>
     <a href="javascript:;"  class="weui-btn weui-btn_warn" id="dettach-button">解绑</a>
    </div>

    <div class="detail-dialog" style="display: none;" id="dettach-dialog">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd">
                <strong class="weui-dialog__title">确认解绑吗？</strong>
            </div>
             <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">残忍解绑</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">取消</a>
            </div>
        </div>
    </div>

    <script>
    $.getJSON('/api/u/bind', urlParam, function(data){
        //data = {"code": 1, "data": 'lizy14', "msg": ""}
        code = data.code;
        $('.weui-loadmore').hide();
        if (code == 1) {
            $('#bind-container').show();
        }
        else if (code == 0) {
            $('#unbind-container').show();
            new Vue({
                el: '#unbind-container',
                data: {
                    'id': data.data,
                    'urlParam': urlParam,
                }
            })
        }
    })

    // pop confirmation dialog when click '解绑'
    $(function(){
        $('#dettach-dialog').on('click', '.weui-dialog__btn_primary', function(){
            $(this).parents('.detail-dialog').fadeOut(200);
        });

        $('#dettach-button').on('click', function(){
            $('#dettach-dialog').fadeIn(200);
        });
    });

    // submit 
    $(function(){
        $('#confirm-button').on('click', function() {
            data = urlParam;
            data['student_id'] = $('#inputUsername').val();
            data['password'] = $('#inputPassword').val() ;
            $.post("/api/u/bind", data, 
                function(data,status){
                //alert("Data: " + data.msg + "\nStatus: " + status);
                if (data.code == 0) {
                    msg = {title: '绑定成功'};
                    new Vue({
                        el: '#msg-dialog',
                        data: {
                            'msg': msg,
                            'urlParam': urlParam,
                        }
                    });
                }
                else {
                    msg = {title: '出错啦', content: data.msg};
                    new Vue({
                        el: '#msg-dialog',
                        data: {
                            'msg': msg,
                            'urlParam': urlParam,
                        }
                    });
                }
                $('#msg-dialog').fadeIn(200);
                $('#msg-dialog').on('click', '.weui-dialog__btn', function(){
                    $(this).parents('.detail-dialog').fadeOut(200);
                });
            });
        })
        
    });

    </script>



</body>
